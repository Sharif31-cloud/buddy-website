<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Signal Dashboard</title>

<link rel="icon" type="image/png" href="logo_icon.png">
<link rel="shortcut icon" href="favicon.ico">

<meta name="description" content="AI Signal Dashboard for Forex, Crypto, and Commodities with EMA, RSI, and MACD indicators.">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:15px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
select,button,input{padding:8px;border-radius:6px;border:none}
button{background:#2563eb;color:white;cursor:pointer}
button.secondary{background:#334155}
#signals{padding:20px}
.signal{background:#020617;padding:20px;border-radius:12px;max-width:420px;margin:auto;position:relative}
.vip-badge{position:absolute;top:10px;right:10px;background:#22c55e;color:#fff;padding:4px 8px;border-radius:8px;font-weight:bold}
.buy{color:#22c55e}
.sell{color:#ef4444}
.hold{color:#9ca3af}
.vip-lock{filter:blur(7px);pointer-events:none}
#authBox{display:flex;gap:6px;flex-wrap:wrap}
#tidBox{display:none;flex-direction:column;gap:6px;margin-top:10px;background:#1e293b;padding:12px;border-radius:10px}
#vipTimer{font-weight:bold;color:#22c55e}
select option.free-symbol{color:#22c55e;font-weight:bold}
</style>
</head>

<body>

<header>
  <div>
    <h3>ðŸ“Š AI Signal Dashboard</h3>
    <select id="symbol">
      <option value="XAU/USD">XAU/USD</option>
      <option value="EUR/USD" class="free-symbol">EUR/USD (Free)</option>
      <option value="GBP/USD" class="free-symbol">GBP/USD (Free)</option>
      <option value="USD/JPY">USD/JPY</option>
      <option value="BTC/USD">BTC/USD</option>
    </select>
  </div>

  <div id="authBox">
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="registerBtn" class="secondary">Register</button>
    <button id="upgradeBtn" class="secondary" style="display:none">Request VIP</button>
    <div id="vipTimer"></div>

    <div id="tidBox">
      <p style="color:#fbbf24;margin:0">
        Send 5k UGX to 0748244415 and enter TID
      </p>
      <input id="tidInput" placeholder="TID 123456789012">
      <button id="activateVipBtn" style="background:#22c55e">Submit TID</button>
    </div>
  </div>
</header>

<div id="chart"></div>
<div id="signals">Loadingâ€¦</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1G6DhAZv70YLk65ESgZl0Cm1BHzab4a0",
  authDomain: "buddydownloads-72e3b.firebaseapp.com",
  databaseURL: "https://buddydownloads-72e3b-default-rtdb.firebaseio.com",
  projectId: "buddydownloads-72e3b",
  storageBucket: "buddydownloads-72e3b.appspot.com",
  messagingSenderId: "782621240629",
  appId: "1:782621240629:web:4678fac59caad0f3ac707c"
};

initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

const email = document.getElementById("email");
const password = document.getElementById("password");
const upgradeBtn = document.getElementById("upgradeBtn");
const tidBox = document.getElementById("tidBox");
const vipTimer = document.getElementById("vipTimer");
const symbol = document.getElementById("symbol");
const signals = document.getElementById("signals");

let isVIP = false;
let vipInterval = null;
const freeSymbols = ["EUR/USD","GBP/USD"];

/* ---------- VIP EXPIRY ENFORCER ---------- */
async function enforceVip(uid, data){
  if(!data.vip || !data.vipExpiry) return;

  if(Date.now() >= new Date(data.vipExpiry).getTime()){
    await set(ref(db,"users/"+uid),{
      email:data.email,
      vip:false,
      vipExpiredAt:new Date().toISOString()
    });
    isVIP=false;
    vipTimer.innerText="VIP expired â³";
    upgradeBtn.style.display="inline-block";
  }
}

/* ---------- COUNTDOWN ---------- */
function startCountdown(expiry){
  clearInterval(vipInterval);
  vipInterval=setInterval(()=>{
    const diff=new Date(expiry)-Date.now();
    if(diff<=0){
      clearInterval(vipInterval);
      vipTimer.innerText="VIP expired â³";
      isVIP=false;
      upgradeBtn.style.display="inline-block";
      runSignals();
      return;
    }
    const d=Math.floor(diff/86400000),
          h=Math.floor(diff%86400000/3600000),
          m=Math.floor(diff%3600000/60000),
          s=Math.floor(diff%60000/1000);
    vipTimer.innerText=`VIP expires in ${d}d ${h}h ${m}m ${s}s`;
  },1000);
}

/* ---------- AUTH ---------- */
loginBtn.onclick=()=>signInWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
registerBtn.onclick=()=>createUserWithEmailAndPassword(auth,email.value,password.value).then(u=>{
  set(ref(db,"users/"+u.user.uid),{email:u.user.email,vip:false});
  alert("Account created");
});

onAuthStateChanged(auth,async user=>{
  if(!user) return;
  const snap=await get(child(ref(db),"users/"+user.uid));
  const data=snap.val()||{};
  await enforceVip(user.uid,data);
  isVIP=data.vip===true;
  if(isVIP && data.vipExpiry) startCountdown(data.vipExpiry);
  upgradeBtn.style.display=isVIP?"none":"inline-block";
  runSignals();
});

/* ---------- SIGNAL UI ---------- */
function runSignals(){
  const sym=symbol.value;
  const isFree=freeSymbols.includes(sym);
  const locked=!isVIP && !isFree;
  signals.innerHTML=`
    <div class="signal ${locked?'vip-lock':''}">
      ${isVIP?'<div class="vip-badge">VIP</div>':isFree?'<div class="vip-badge">FREE</div>':''}
      <h3>${sym}</h3>
      <h2 class="buy">BUY</h2>
      <p>Entry: 1.2345</p>
      <p>SL: 1.2300</p>
      <p>TP: 1.2450</p>
    </div>
    ${locked?'<p style="text-align:center">ðŸ”’ VIP required</p>':''}
  `;
}

symbol.onchange=runSignals;
</script>

<script src="https://s3.tradingview.com/tv.js"></script>
</body>
</html>
